<!-- Hero -->
<div class="hero" id="hero">
  <div class="logo">make life <span class="accent">simpler</span></div>
  <p class="tagline">Curated tools, products, and discoveries that actually save you time. No fluff, no filler ‚Äî just things that work.</p>
  <div class="search-bar">
    <span class="icon">üîç</span>
    <input type="text" id="searchInput" placeholder="Search {{TOTAL_ARTICLES}}+ curated recommendations...">
  </div>
</div>

<!-- Stats -->
<div class="stats" id="stats">
  <div class="stat">
    <div class="num">{{TOTAL_ARTICLES}}</div>
    <div class="label">Curated Picks</div>
  </div>
  <div class="stat">
    <div class="num">{{TOTAL_TAGS}}</div>
    <div class="label">Categories</div>
  </div>
  <div class="stat">
    <div class="num">{{TOTAL_CLICKS}}</div>
    <div class="label">People Helped</div>
  </div>
  <div class="stat">
    <div class="num">New</div>
    <div class="label">Updated Weekly</div>
  </div>
</div>

<!-- Tabs -->
<div id="tabsWrapper">
  <div class="tabs" id="tabs">
    {{TABS}}
  </div>
</div>

<!-- Filter mode result count -->
<div class="filter-status" id="filterStatus">
  <span id="filterCount"></span>
  <button class="filter-clear" id="filterClear">‚úï Clear</button>
</div>

<div class="content" id="content">
  <!-- Featured -->
  {{FEATURED}}

  <!-- Sections -->
  {{SECTIONS}}
</div>

<!-- Filter mode: flat card list (hidden by default) -->
<div class="filter-results" id="filterResults"></div>

<script>
(function() {
  var body = document.body;
  var hero = document.getElementById('hero');
  var stats = document.getElementById('stats');
  var tabsWrapper = document.getElementById('tabsWrapper');
  var tabsEl = document.getElementById('tabs');
  var content = document.getElementById('content');
  var filterStatus = document.getElementById('filterStatus');
  var filterCount = document.getElementById('filterCount');
  var filterClear = document.getElementById('filterClear');
  var filterResults = document.getElementById('filterResults');
  var input = document.getElementById('searchInput');
  var cards = document.querySelectorAll('.item-card');
  var tabs = document.querySelectorAll('.tab');
  var sections = document.querySelectorAll('.section-block');
  var trendingTab = tabs[0];
  var activeTags = new Set();
  var inFilterMode = false;

  // Search (normal mode only)
  input.addEventListener('input', function() {
    if (inFilterMode) return;
    var q = this.value.toLowerCase();
    cards.forEach(function(card) {
      var text = card.dataset.search || '';
      card.style.display = text.includes(q) ? '' : 'none';
    });
    sections.forEach(function(section) {
      var visible = section.querySelectorAll('.item-card:not([style*="display: none"])');
      section.style.display = visible.length ? '' : 'none';
    });
  });

  function enterFilterMode() {
    if (inFilterMode) return;
    inFilterMode = true;
    body.classList.add('filter-mode');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function exitFilterMode() {
    if (!inFilterMode) return;
    inFilterMode = false;
    body.classList.remove('filter-mode');
    filterResults.innerHTML = '';
  }

  function buildFilterCards() {
    // Collect matching cards and clone them into the flat results area
    var matches = [];
    cards.forEach(function(card) {
      var cardTags = (card.dataset.tags || '').split(',');
      var match = Array.from(activeTags).some(function(t) { return cardTags.indexOf(t) !== -1; });
      if (match) matches.push(card);
    });

    // Update count
    var tagNames = Array.from(activeTags).join(', ');
    filterCount.textContent = matches.length + ' pick' + (matches.length !== 1 ? 's' : '') + ' in ' + tagNames;

    // Build results
    filterResults.innerHTML = '';
    if (matches.length === 0) {
      filterResults.innerHTML = '<div class="filter-empty">No picks match these filters.</div>';
      return;
    }
    var grid = document.createElement('div');
    grid.className = 'filter-grid';
    matches.forEach(function(card) {
      var clone = card.cloneNode(true);
      clone.style.display = '';
      clone.classList.add('filter-card-enter');
      grid.appendChild(clone);
    });
    filterResults.appendChild(grid);

    // Trigger animation
    requestAnimationFrame(function() {
      grid.querySelectorAll('.filter-card-enter').forEach(function(c, i) {
        setTimeout(function() { c.classList.add('filter-card-visible'); }, i * 40);
      });
    });
  }

  function applyFilters() {
    if (activeTags.size > 0) {
      enterFilterMode();
      buildFilterCards();
    } else {
      exitFilterMode();
      // Reset normal view
      cards.forEach(function(card) { card.style.display = ''; });
      sections.forEach(function(section) { section.style.display = ''; });
    }
  }

  tabs.forEach(function(tab) {
    tab.addEventListener('click', function() {
      var tag = this.dataset.tag;

      if (!tag) {
        // Trending ‚Äî exit filter mode
        activeTags.clear();
        tabs.forEach(function(t) { t.classList.remove('active'); });
        trendingTab.classList.add('active');
        applyFilters();
        return;
      }

      // Toggle tag
      if (activeTags.has(tag)) {
        activeTags.delete(tag);
        this.classList.remove('active');
      } else {
        activeTags.add(tag);
        this.classList.add('active');
        trendingTab.classList.remove('active');
      }

      if (activeTags.size === 0) {
        trendingTab.classList.add('active');
      }

      applyFilters();
    });
  });

  // Clear button
  filterClear.addEventListener('click', function() {
    activeTags.clear();
    tabs.forEach(function(t) { t.classList.remove('active'); });
    trendingTab.classList.add('active');
    applyFilters();
  });

  // Sticky tabs on scroll (normal mode)
  function updateSticky() {
    if (inFilterMode) return;
    var rect = tabsWrapper.getBoundingClientRect();
    if (rect.top <= 0) {
      if (!tabsEl.classList.contains('sticky')) {
        tabsWrapper.style.minHeight = tabsEl.offsetHeight + 'px';
        tabsEl.classList.add('sticky');
      }
    } else {
      tabsEl.classList.remove('sticky');
      tabsWrapper.style.minHeight = '';
    }
  }
  window.addEventListener('scroll', updateSticky, { passive: true });
})();
</script>
